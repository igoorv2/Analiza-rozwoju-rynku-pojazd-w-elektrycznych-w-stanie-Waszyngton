labs(
title = "Trend Technologiczny: redni Zasig BEV w Czasie",
x = "Rok Modelowy",
y = "redni Zasig (Mile)"
) +
theme_minimal() +
# Dodanie etykiet z wartoci (opcjonalne, ale pomocne)
geom_text(aes(label = round(Zasieg_avg, 0)), vjust = -1, size = 3)
print(wykres_zasieg)
# Weryfikacja i normalizacja nazw kolumn do poczenia
# Nazwy hrabstw w TIGER (mapa) s w kolumnie 'NAME' i s pisane wielkimi literami.
# Musimy to znormalizowa z Paskimi danymi.
# Przygotowanie mapy do czenia:
mapa_przygotowana <- mapa_hrabstw %>%
# Usuwamy ' County' i konwertujemy na wielkie litery, jeli to konieczne
mutate(hrabstwo_mapa = toupper(gsub(" County", "", NAME)))
# Przygotowanie tabeli lider贸w (zakadamy, 偶e ta tabela istnieje z poprzednich krok贸w)
liderzy_przygotowani <- liderzy_regionalni %>%
rename(hrabstwo_dane = hrabstwo) # U偶ywamy nazwy hrabstwa z Paskich danych
# Weryfikacja i normalizacja nazw kolumn do poczenia
mapa_przygotowana <- mapa_hrabstw %>%
# Tworzymy kolumn do czenia: usuwamy ' County' i konwertujemy na wielkie litery
mutate(hrabstwo_mapa = toupper(gsub(" County", "", NAME)))
# Zakadamy, 偶e tabela liderzy_regionalni istnieje z wczeniejszej agregacji
# U偶ywamy left_join:
mapa_finalna <- mapa_przygotowana %>%
left_join(liderzy_regionalni, by = c("hrabstwo_mapa" = "hrabstwo"))
library(dplyr)
library(ggplot2)
library(viridis)
# 1. Agregacja: Zliczanie rejestracji Marki na Hrabstwo
liderzy_marki_regionalni <- dane %>%
filter(typ_pojazdu_elektrycznego %in% c("Battery Electric Vehicle", "Plug-in Hybrid Electric Vehicle")) %>%
# Grupowanie i zliczanie
group_by(hrabstwo, marka) %>%
summarise(Liczba_Rejestracji = n(), .groups = "drop_last") %>%
# Wyb贸r Lidera (marki z najwiksz liczb rejestracji) w ka偶dym hrabstwie
slice_max(Liczba_Rejestracji, n = 1, with_ties = FALSE) %>%
ungroup() %>%
# Zmieniamy nazw kolumny na Dominujca_Marka
rename(Dominujaca_Marka = marka)
cat("Tabela Lider贸w Regionalnych (Marka) jest gotowa.\n")
# Zakadamy, 偶e kolumna z nazwami hrabstw w obiekcie mapa_hrabstw to 'NAME'
# 1. Przygotowanie mapy do czenia (normalizacja nazw)
# Robimy t sam normalizacj co wczeniej: usuwamy ' County' i konwertujemy na wielkie litery
mapa_przygotowana <- mapa_hrabstw %>%
mutate(hrabstwo_mapa = toupper(gsub(" County", "", NAME)))
# 2. czenie:
mapa_finalna <- mapa_przygotowana %>%
# czymy po kolumnie 'hrabstwo_mapa' z kolumn 'hrabstwo' z danych lider贸w
left_join(liderzy_marki_regionalni, by = c("hrabstwo_mapa" = "hrabstwo"))
cat("Poczenie danych zakoczone. Generowanie mapy.")
# 3. Wizualizacja Mapy (Wykres Choropleth)
[Image of map visualization of statistical data]
# Zakadamy, 偶e kolumna z nazwami hrabstw w obiekcie mapa_hrabstw to 'NAME'
# 1. Przygotowanie mapy do czenia (normalizacja nazw)
# Robimy t sam normalizacj co wczeniej: usuwamy ' County' i konwertujemy na wielkie litery
mapa_przygotowana <- mapa_hrabstw %>%
mutate(hrabstwo_mapa = toupper(gsub(" County", "", NAME)))
# 2. czenie:
mapa_finalna <- mapa_przygotowana %>%
# czymy po kolumnie 'hrabstwo_mapa' z kolumn 'hrabstwo' z danych lider贸w
left_join(liderzy_marki_regionalni, by = c("hrabstwo_mapa" = "hrabstwo"))
cat("Poczenie danych zakoczone. Generowanie mapy.")
# 3. Wizualizacja Mapy (Wykres Choropleth)
wykres_mapa_marka <- ggplot(data = mapa_finalna) +
# Rysujemy map, kolor wypenienia (fill) zale偶y od Dominujcej Marki
geom_sf(aes(fill = Dominujaca_Marka), color = "white", linewidth = 0.2) +
# U偶ywamy skali jakociowej dla kolor贸w (viridis_d)
scale_fill_viridis_d(name = "Dominujca Marka",
na.value = "grey80",
guide = guide_legend(ncol = 1)) +
labs(
title = "Dominujca Marka Pojazdu Elektrycznego wedug Hrabstwa (WA)",
subtitle = "Kolor odzwierciedla mark z najwiksz liczb rejestracji (BEV & PHEV)."
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.title = element_text(hjust = 0.5, face = "bold"),
legend.position = "bottom"
)
print(wykres_mapa_marka)
# Wczytanie bibliotek i danych
library(dplyr)
library(sf)
library(ggplot2)
# --- Normalizacja Danych Zewntrznych (Mapy) ---
mapa_przygotowana <- mapa_hrabstw %>%
# Tworzymy czyst, wielk literow kolumn czc
# Usuwamy " County" i konwertujemy na wielkie litery
mutate(hrabstwo_klucz = toupper(gsub(" County", "", NAME)))
# --- Normalizacja Danych Lider贸w (Paskie dane) ---
# Nale偶y si upewni, 偶e Paskie hrabstwa te偶 s wielk liter
liderzy_przygotowani <- liderzy_marki_regionalni %>%
mutate(hrabstwo_klucz = toupper(hrabstwo)) # Konwersja na wielkie litery
# 2. czenie:
mapa_finalna <- mapa_przygotowana %>%
# czymy po nowym, znormalizowanym kluczu
left_join(liderzy_przygotowani, by = "hrabstwo_klucz")
# 3. Wizualizacja Mapy (Wykres Choropleth)
wykres_mapa_marka <- ggplot(data = mapa_finalna) +
# Rysujemy map, kolor wypenienia (fill) zale偶y od Dominujcej Marki
geom_sf(aes(fill = Dominujaca_Marka), color = "white", linewidth = 0.2) +
# U偶ywamy skali jakociowej dla kolor贸w (viridis_d)
scale_fill_viridis_d(name = "Dominujca Marka",
na.value = "grey80",
guide = guide_legend(ncol = 1)) +
labs(
title = "Dominujca Marka Pojazdu Elektrycznego wedug Hrabstwa (WA)",
subtitle = "Kolor odzwierciedla mark z najwiksz liczb rejestracji (BEV & PHEV)."
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.title = element_text(hjust = 0.5, face = "bold"),
legend.position = "bottom"
)
print(wykres_mapa_marka)
library(dplyr)
library(sf)
library(ggplot2)
mapa_przygotowana <- mapa_hrabstw %>%
mutate(hrabstwo_klucz = toupper(gsub(" County", "", NAME)))
liderzy_przygotowani <- liderzy_marki_regionalni %>%
mutate(hrabstwo_klucz = toupper(hrabstwo))
mapa_finalna <- mapa_przygotowana %>%
left_join(liderzy_przygotowani, by = "hrabstwo_klucz")
wykres_mapa_marka <- ggplot(data = mapa_finalna) +
geom_sf(aes(fill = Dominujaca_Marka), color = "white", linewidth = 0.2) +
scale_fill_viridis_d(name = "Dominujca Marka",
na.value = "grey80",
guide = guide_legend(ncol = 1)) +
labs(
title = "Dominujca Marka Pojazdu Elektrycznego wedug Hrabstwa (WA)",
subtitle = "Kolor odzwierciedla mark z najwiksz liczb rejestracji (BEV & PHEV)."
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.title = element_text(hjust = 0.5, face = "bold"),
legend.position = "bottom"
)
print(wykres_mapa_marka)
library(dplyr)
library(knitr)
library(kableExtra)
dominacja_marek %>%           # to jest ten df po group_by(hrabstwo, marka) + slice(1)
arrange(hrabstwo) %>%
rename(
Hrabstwo = hrabstwo,
Marka    = dominujaca_marka,
Rejestracje = liczba
) %>%
kable(
caption   = "Dominujca marka pojazd贸w elektrycznych w poszczeg贸lnych hrabstwach (BEV + PHEV)",
col.names = c("Hrabstwo", "Dominujca marka", "Liczba rejestracji"),
align     = "lcc"
) %>%
kable_styling(full_width = FALSE, bootstrap_options = c("striped", "hover"))
library(dplyr)
library(tidyr)
# 1. Wyodrbnienie kluczy z mapy (mapa_przygotowana)
# Wczeniej u偶ylimy klucza: hrabstwo_klucz, kt贸ry jest uproszczon nazw
klucze_mapy <- mapa_przygotowana %>%
st_drop_geometry() %>% # Usuwamy geometri, by pracowa tylko na danych
select(hrabstwo_klucz) %>%
unique() %>%
mutate(Zrodlo = "Mapa_Tigris") %>%
rename(Nazwa_Hrabstwa = hrabstwo_klucz)
# 2. Wyodrbnienie kluczy z danych lider贸w (liderzy_marki_regionalni)
klucze_danych <- liderzy_marki_regionalni %>%
select(hrabstwo) %>%
unique() %>%
# Tworzymy klucz na podstawie normalizacji, kt贸ra miaa by w join
mutate(Nazwa_Hrabstwa = toupper(hrabstwo)) %>%
select(Nazwa_Hrabstwa) %>%
mutate(Zrodlo = "Dane_Liderzy")
# 3. Poczenie kluczy, aby zobaczy niezgodnoci
# U偶ywamy FULL JOIN, aby zobaczy, kt贸re nazwy istniej tylko w jednym zbiorze
tabela_porownawcza <- full_join(klucze_mapy, klucze_danych, by = "Nazwa_Hrabstwa") %>%
mutate(Status = case_when(
!is.na(Zrodlo.x) & is.na(Zrodlo.y) ~ "Brakuje w Twoich Danych (Brak Danych/Nazwa Inna)",
is.na(Zrodlo.x) & !is.na(Zrodlo.y) ~ "Brakuje w Mapie (Nazwa Inna w Mapie)",
TRUE ~ "ZGODA"
)) %>%
select(Nazwa_Hrabstwa, Status) %>%
arrange(Status, Nazwa_Hrabstwa)
# 4. Wywietlenie problematycznych hrabstw
cat("###  Tabela Por贸wnawcza Nazw Hrabstw\n")
print(tabela_porownawcza)
library(knitr)
library(kableExtra)
tabela_liderzy <- liderzy_marki_regionalni %>%
arrange(hrabstwo) %>%
rename(
Hrabstwo          = hrabstwo,
`Dominujca marka` = Dominujaca_Marka,
`Liczba rejestracji` = Liczba_Rejestracji
)
tabela_liderzy %>%
kable(
caption = "Dominujca marka pojazd贸w elektrycznych w poszczeg贸lnych hrabstwach (BEV + PHEV)",
align   = "lcc"
) %>%
kable_styling(full_width = FALSE, bootstrap_options = c("striped", "hover"))
library(dplyr)
library(sf)
library(ggplot2)
wykres_mapa_marka <- ggplot(data = mapa_finalna) +
geom_sf(aes(fill = Dominujaca_Marka), color = "white", linewidth = 0.2) +
scale_fill_viridis_d(
name = "Dominujca Marka",
na.value = "grey80"
) +
guides(
fill = guide_legend(
title.position = "top",  # tytu nad legend
ncol = 1
)
) +
labs(
title = "Dominujca Marka Pojazdu Elektrycznego wedug Hrabstwa (WA)",
subtitle = "Kolor odzwierciedla mark z najwiksz liczb rejestracji (BEV & PHEV)."
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.title = element_text(hjust = 0.5, face = "bold"),
legend.position = "bottom",
legend.title = element_text(hjust = 0.5)  # wycentruj tytu legendy
)
print(wykres_mapa_marka)
library(dplyr)
library(ggplot2)
library(viridis)
liderzy_marki_regionalni <- dane %>%
filter(typ_pojazdu_elektrycznego %in% c("Battery Electric Vehicle", "Plug-in Hybrid Electric Vehicle")) %>%
group_by(hrabstwo, marka) %>%
summarise(Liczba_Rejestracji = n(), .groups = "drop_last") %>%
slice_max(Liczba_Rejestracji, n = 1, with_ties = FALSE) %>%
ungroup() %>%
rename(Dominujaca_Marka = marka)
library(dplyr)
library(sf)
library(ggplot2)
wykres_mapa_marka <- ggplot(data = mapa_finalna) +
geom_sf(aes(fill = Dominujaca_Marka), color = "white", linewidth = 0.2) +
scale_fill_viridis_d(
name = "Dominujca Marka",
na.value = "grey80"
) +
guides(
fill = guide_legend(
title.position = "top",
ncol = 1
)
) +
labs(
title = "Dominujca Marka Pojazdu Elektrycznego wedug Hrabstwa (WA)",
subtitle = "Kolor odzwierciedla mark z najwiksz liczb rejestracji (BEV & PHEV)."
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.title = element_text(hjust = 0.5, face = "bold"),
legend.position = "bottom",
legend.title = element_text(hjust = 0.5)
)
print(wykres_mapa_marka)
library(dplyr)
library(sf)
library(ggplot2)
wykres_mapa_marka <- ggplot(data = mapa_hrabstw) +
geom_sf(aes(fill = Dominujaca_Marka), color = "white", linewidth = 0.2) +
scale_fill_viridis_d(
name = "Dominujca Marka",
na.value = "grey80"
) +
guides(
fill = guide_legend(
title.position = "top",
ncol = 1
)
) +
labs(
title = "Dominujca Marka Pojazdu Elektrycznego wedug Hrabstwa (WA)",
subtitle = "Kolor odzwierciedla mark z najwiksz liczb rejestracji (BEV & PHEV)."
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.title = element_text(hjust = 0.5, face = "bold"),
legend.position = "bottom",
legend.title = element_text(hjust = 0.5)
)
print(wykres_mapa_marka)
library(dplyr)
library(ggplot2)
library(viridis)
liderzy_marki_regionalni <- dane %>%
filter(typ_pojazdu_elektrycznego %in% c("Battery Electric Vehicle", "Plug-in Hybrid Electric Vehicle")) %>%
group_by(hrabstwo, marka) %>%
summarise(Liczba_Rejestracji = n(), .groups = "drop_last") %>%
slice_max(Liczba_Rejestracji, n = 1, with_ties = FALSE) %>%
ungroup() %>%
rename(Dominujaca_Marka = marka)
library(dplyr)
library(sf)
library(ggplot2)
wykres_mapa_marka <- ggplot(data = mapa_hrabstw) +
geom_sf(aes(fill = Dominujaca_Marka), color = "white", linewidth = 0.2) +
scale_fill_viridis_d(
name = "Dominujca Marka",
na.value = "grey80"
) +
guides(
fill = guide_legend(
title.position = "top",
ncol = 1
)
) +
labs(
title = "Dominujca Marka Pojazdu Elektrycznego wedug Hrabstwa (WA)",
subtitle = "Kolor odzwierciedla mark z najwiksz liczb rejestracji (BEV & PHEV)."
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.title = element_text(hjust = 0.5, face = "bold"),
legend.position = "bottom",
legend.title = element_text(hjust = 0.5)
)
print(wykres_mapa_marka)
library(dplyr)
library(sf)
library(ggplot2)
wykres_mapa_marka <- ggplot(data = mapa_finalna) +
geom_sf(aes(fill = Dominujaca_Marka), color = "white", linewidth = 0.2) +
scale_fill_viridis_d(
name = "Dominujca Marka",
na.value = "grey80"
) +
guides(
fill = guide_legend(
title.position = "top",
ncol = 1
)
) +
labs(
title = "Dominujca Marka Pojazdu Elektrycznego wedug Hrabstwa (WA)",
subtitle = "Kolor odzwierciedla mark z najwiksz liczb rejestracji (BEV & PHEV)."
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.title = element_text(hjust = 0.5, face = "bold"),
legend.position = "bottom",
legend.title = element_text(hjust = 0.5)
)
print(wykres_mapa_marka)
library(dplyr)
library(ggplot2)
library(viridis)
liderzy_marki_regionalni <- dane %>%
filter(typ_pojazdu_elektrycznego %in% c("Battery Electric Vehicle", "Plug-in Hybrid Electric Vehicle")) %>%
group_by(hrabstwo, marka) %>%
summarise(Liczba_Rejestracji = n(), .groups = "drop") %>% # Zmieniono 'drop_last' na 'drop' dla pewnoci
slice_max(Liczba_Rejestracji, n = 1, with_ties = FALSE) %>%
ungroup() %>%
rename(Dominujaca_Marka = marka, NAME = hrabstwo)
library(dplyr)
library(sf)
library(ggplot2)
wykres_mapa_marka <- ggplot(data = mapa_finalna) +
geom_sf(aes(fill = Dominujaca_Marka), color = "white", linewidth = 0.2) +
scale_fill_viridis_d(
name = "Dominujca Marka",
na.value = "grey80"
) +
guides(
fill = guide_legend(
title.position = "top",
ncol = 1
)
) +
labs(
title = "Dominujca Marka Pojazdu Elektrycznego wedug Hrabstwa (WA)",
subtitle = "Kolor odzwierciedla mark z najwiksz liczb rejestracji (BEV & PHEV)."
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.title = element_text(hjust = 0.5, face = "bold"),
legend.position = "bottom",
legend.title = element_text(hjust = 0.5)
)
print(wykres_mapa_marka)
library(dplyr)
library(ggplot2)
library(viridis)
liderzy_marki_regionalni <- dane %>%
filter(typ_pojazdu_elektrycznego %in% c("Battery Electric Vehicle", "Plug-in Hybrid Electric Vehicle")) %>%
group_by(hrabstwo, marka) %>%
summarise(Liczba_Rejestracji = n(), .groups = "drop") %>%
slice_max(Liczba_Rejestracji, n = 1, with_ties = FALSE) %>%
ungroup() %>%
rename(Dominujaca_Marka = marka, NAME = hrabstwo)
mapa_finalna <- mapa_hrabstw_sf %>%
left_join(liderzy_marki_regionalni, by = "NAME")
library(dplyr)
library(ggplot2)
library(viridis)
# 1. Obliczenie dominujcej marki i przypisanie do 'liderzy_marki_regionalni'
liderzy_marki_regionalni <- dane %>%
filter(typ_pojazdu_elektrycznego %in% c("Battery Electric Vehicle", "Plug-in Hybrid Electric Vehicle")) %>%
group_by(hrabstwo, marka) %>%
summarise(Liczba_Rejestracji = n(), .groups = "drop") %>%
slice_max(Liczba_Rejestracji, n = 1, with_ties = FALSE) %>%
ungroup() %>%
# Zmieniamy nazw kolumny, aby pasowaa do mapy (NAME)
rename(Dominujaca_Marka = marka, NAME = hrabstwo)
# 2. Poczenie mapy z danymi statystycznymi
mapa_finalna <- mapa_hrabstw %>%
left_join(liderzy_marki_regionalni, by = "NAME")
wykres_mapa_marka <- ggplot(data = mapa_finalna) +
geom_sf(aes(fill = Dominujaca_Marka), color = "white", linewidth = 0.2) +
scale_fill_viridis_d(
name = "Dominujca Marka",
na.value = "grey80"
) +
guides(
fill = guide_legend(
title.position = "top",
ncol = 1
)
) +
labs(
title = "Dominujca Marka Pojazdu Elektrycznego wedug Hrabstwa (WA)",
subtitle = "Kolor odzwierciedla mark z najwiksz liczb rejestracji (BEV & PHEV)."
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.title = element_text(hjust = 0.5, face = "bold"),
legend.position = "bottom",
legend.title = element_text(hjust = 0.5)
)
print(wykres_mapa_marka)
library(dplyr)
library(ggplot2)
library(viridis)
liderzy_marki_regionalni <- dane %>%
filter(typ_pojazdu_elektrycznego %in% c("Battery Electric Vehicle",
"Plug-in Hybrid Electric Vehicle")) %>%
group_by(hrabstwo, marka) %>%
summarise(Liczba_Rejestracji = n(), .groups = "drop_last") %>%
slice_max(Liczba_Rejestracji, n = 1, with_ties = FALSE) %>%
ungroup() %>%
rename(Dominujaca_Marka = marka)
mapa_przygotowana <- mapa_hrabstw %>%
mutate(hrabstwo_klucz = toupper(gsub(" County", "", NAME)))
liderzy_przygotowani <- liderzy_marki_regionalni %>%
mutate(hrabstwo_klucz = toupper(hrabstwo))
mapa_finalna <- mapa_przygotowana %>%
left_join(liderzy_przygotowani, by = "hrabstwo_klucz")
wykres_mapa_marka <- ggplot(data = mapa_finalna) +
geom_sf(aes(fill = Dominujaca_Marka), color = "white", linewidth = 0.2) +
scale_fill_viridis_d(
name = "Dominujca Marka",
na.value = "grey80"
) +
guides(
fill = guide_legend(
title.position = "top",
ncol = 1
)
) +
labs(
title = "Dominujca Marka Pojazdu Elektrycznego wedug Hrabstwa (WA)",
subtitle = "Kolor odzwierciedla mark z najwiksz liczb rejestracji (BEV & PHEV)."
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.title = element_text(hjust = 0.5, face = "bold"),
legend.position = "bottom",
legend.title = element_text(hjust = 0.5)
)
print(wykres_mapa_marka)
